<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-extend="mail.widget.Thread.Message">
          <t t-jquery="div" t-operation="replace">  <div t-att-class="'o_thread_message' + (message.getID() === options.selectedMessageID ? 'o_thread_selected_message ' : ' ') + (message.isMyselfAuthor()? ' align-right' : ' align-left')+(!displayAuthorMessages[message.getID()]?' coll':'') + (message.isDiscussion() or message.isNotification() ? ' o_mail_discussion' : ' o_mail_not_discussion')" t-att-data-message-id="message.getID()">
            <div t-if="displayAuthorMessages[message.getID()] and options.displayAvatars" class="o_thread_message_sidebar">
                <t t-if="message.hasAuthor()">
                    <img t-if="displayAuthorMessages[message.getID()] and !message.isMyselfAuthor()"
                        alt=""
                        t-att-src="message.getAvatarSource()"
                        data-oe-model="res.partner"
                        t-att-data-oe-id="message.shouldRedirectToAuthor() ? message.getAuthorID() : ''"
                        t-attf-class="o_thread_message_avatar rounded-circle #{message.shouldRedirectToAuthor() ? 'o_mail_redirect' : ''}"/>
                </t>
                <t t-else="">
                    <img t-if="displayAuthorMessages[message.getID()]"
                        alt=""
                        t-att-src="message.getAvatarSource()"
                        class="o_thread_message_avatar rounded-circle"/>
                </t>
                <span t-if="!displayAuthorMessages[message.getID()]" t-att-title="message.getDate().format(dateFormat)" class="o_thread_message_side_date">
                    <t t-esc="message.getDate().format('hh:mm')"/>
                        <t t-if="!message.hasCustomerEmailData() and message.isMyselfAuthor()" t-call="mail.chat.Option"/>
                </span>
                <i t-if="!displayAuthorMessages[message.getID()] and options.displayStars and message.getType() !== 'notification'"
                    t-att-class="'fa o_thread_message_star o_thread_icon ' + (message.isStarred() ? 'fa-star' : 'fa-star-o')"
                    t-att-data-message-id="message.getID()" title="Mark as Todo" role="img" aria-label="Mark as todo"/>
            </div>
            <div class="o_thread_message_core">

                  <div t-if="!displayAuthorMessages[message.getID()] and options.displayAvatars" t-att-class="'o_thread_message_sidebar_small hide '+(!displayAuthorMessages[message.getID()] and message.isMyselfAuthor()?'text-right marge':'text-left')">
                  <span t-if="!displayAuthorMessages[message.getID()]" t-att-title="message.getDate().format(dateFormat)" class="o_thread_message_side_date">
                     <t t-esc="message.getDate().format('hh:mm')"/>
                    <t  t-call="mail.chat.Option"/>
                    </span>
                </div>

                <p t-if="displayAuthorMessages[message.getID()]" t-att-class="'o_mail_info  text-muted message-data' + (!message.hasCustomerEmailData() and message.isMyselfAuthor()?' text-right':'')">

                    <input t-if="message.needsModeration() and message.needsModerationByUser()" type="checkbox" class="moderation_checkbox" t-att-data-message-id="message.getID()"/>
                    <t t-if="message.isNote()">
                        Note by
                    </t>
                        <t t-if="!message.hasCustomerEmailData() and message.isMyselfAuthor()" t-call="mail.chat.Option"/>
                    <small class="o_mail_timestamp"  t-if="message.isMyselfAuthor()"  t-att-title="message.getDate().format(dateFormat)"><t t-esc="message.getTimeElapsed()"/> - </small>
                    <strong t-if="message.hasAuthor()"
                            data-oe-model="res.partner" t-att-data-oe-id="message.shouldRedirectToAuthor() ? message.getAuthorID() : ''"
                            t-attf-class="o_thread_author #{message.shouldRedirectToAuthor() ? 'o_mail_redirect' : ''}">
                        <i t-if="!message.isMyselfAuthor()"  class="fa fa-circle online"></i>
                        <t t-esc="message.getDisplayedAuthor()"/>
                         <i t-if="message.isMyselfAuthor()" class="fa fa-circle online me"></i>
                    </strong>
                    <strong t-elif="message.hasEmailFrom()">
                        <a class="text-muted" t-attf-href="mailto:#{message.getEmailFrom()}?subject=Re: #{message.hasSubject() ? message.getSubject() : ''}">
                            <t t-esc="message.getEmailFrom()"/>
                        </a>
                    </strong>
                    <strong t-else="" class="o_thread_author">
                        <i t-if="!message.isMyselfAuthor()"  class="fa fa-circle online"></i>
                        <t t-esc="message.getDisplayedAuthor()"/>
                         <i t-if="message.isMyselfAuthor()" class="fa fa-circle online me"></i>l
                    </strong>

                    <small class="o_mail_timestamp"   t-if="message.hasCustomerEmailData() || !message.isMyselfAuthor()"  t-att-title="message.getDate().format(dateFormat)">- <t t-esc="message.getTimeElapsed()"/></small>
                    <t t-if="message.isLinkedToDocumentThread() and options.displayDocumentLinks">
                        on <a t-att-href="message.getURL()" t-att-data-oe-model="message.getDocumentModel()" t-att-data-oe-id="message.getDocumentID()" class="o_document_link"><t t-esc="message.getDocumentName()"/></a>
                    </t>
                    <t t-if="message.originatesFromChannel() and (message.getOriginChannelID() !== thread.getID())">
                        (from <a t-att-data-oe-id="message.getOriginChannelID()" href="#">#<t t-esc="message.getOriginChannelName()"/></a>)
                    </t>
                    <span t-if="options.displayEmailIcons and (message.hasCustomerEmailData() or ['exception', 'bounce'].indexOf(message._customerEmailStatus) > -1)" class="o_thread_tooltip_container">

                        <t t-set="fatype" t-value="''"/>
                        <t t-if="message.getCustomerEmailStatus() === 'sent' or message.getCustomerEmailStatus() === 'ready'">
                            <t t-set="fatype" t-value="'-o'"/>
                        </t>
                        <i t-att-class="'o_thread_tooltip o_thread_message_email o_thread_message_email_' + message.getCustomerEmailStatus() + ' fa fa-envelope-o'" t-att-data-message-id="message.getID()"/>
                    </span>

                        <t t-if="message.hasCustomerEmailData() || !message.isMyselfAuthor()" t-call="mail.chat.Option"/>
                </p>

                <div t-att-class="'o_thread_message_content'+(!displayAuthorMessages[message.getID()] and !message.isMyselfAuthor()?' marge':'') + (!message.hasCustomerEmailData() and message.isMyselfAuthor()?' my-message pull-right':' other-message pull-left')">
                         <t t-if="message.hasTrackingValues()">
                        <t t-if="message.hasSubtypeDescription()">
                            <p><t t-esc="message.getSubtypeDescription()"/></p>
                        </t>
                        <t t-call="mail.widget.Thread.MessageTracking"/>
                    </t>
                    <p t-if="options.displaySubjectOnMessages and message.shouldDisplaySubject()" class="o_mail_subject">Subject: <t t-esc="message.getSubject()"/></p>
                    <t t-if="!(message.hasTrackingValues())">
                        <t t-raw="message.getBody()"/>
                    </t>
                    <t t-if="message.hasAttachments()">
                        <div t-if="message.hasImageAttachments()" class="o_attachments_previews">
                            <t t-foreach="message.getImageAttachments()" t-as="attachment">
                                <t t-call="mail.AttachmentPreview"/>
                            </t>
                        </div>
                        <div t-if="message.hasNonImageAttachments()" class="o_attachments_list">
                            <t t-foreach="message.getNonImageAttachments()" t-as="attachment">
                                <t t-call="mail.Attachment"/>
                            </t>
                        </div>
                    </t>
                </div>
            </div>
        </div>
        <t t-if="options.messagesSeparatorPosition == message.getID()">
            <t t-call="mail.MessagesSeparator"/>
        </t>
              <!--<div t-if="!is_system_notification" t-att-class="'o_thread_message' + (message.expanded ? ' o_message_expanded '  : ' ') + (message.is_selected ? 'o_thread_selected_message' : ' ') + (message.is_author ? ' align-right' : ' ')+(!message.display_author?' coll':'')" t-att-data-message-id="message.id">
                    <div t-if="message.display_author and options.display_avatar" class="o_thread_message_sidebar">
                        <t t-if="!message.mailto and message.author_id[0]">
                            <img t-if="message.avatar_src and message.display_author and !message.is_author "
                                t-att-src="message.avatar_src"
                                data-oe-model="res.partner"
                                t-att-data-oe-id="message.author_redirect ? message.author_id[0] : ''"
                                t-attf-class="o_thread_message_avatar img-circle #{message.author_redirect ? 'o_mail_redirect' : ''}"/>
                        </t>
                        <t t-if="message.mailto || !message.author_id[0]">
                            <img t-if="message.avatar_src and message.display_author"
                                t-att-src="message.avatar_src"
                                class="o_thread_message_avatar img-circle"/>
                        </t>
                    </div>
                    <div t-att-class="'o_thread_message_core' + (message.is_note ? ' o_mail_note' : ' ')">

                 <div t-if="!message.display_author and options.display_avatar" t-att-class="'o_thread_message_sidebar_small hide '+(!message.display_author and message.is_author?'text-right marge':'text-left')">
                        <span  t-att-title="message.date.format(date_format)" class="o_thread_message_side_date">
                            <t t-esc="message.date.format('hh:mm')"/>
                        </span>
                        <t t-if="!message.mailto and message.is_author" t-call="mail.chat.Option"/>
                    </div>
                        <p t-if="message.display_author"  t-att-class="'o_mail_info message-data' + (!message.mailto and message.is_author?' text-right':'')">
                            <t t-if="message.is_note">
                                Note by
                            </t>

                            <strong t-if="message.mailto">
                                <a class="o_mail_mailto" t-attf-href="mailto:#{message.mailto}?subject=Re: #{message.subject}">
                                    <t t-esc="message.mailto"/>
                                </a>
                            </strong>

                            <t t-if="!message.mailto and message.is_author" t-call="mail.chat.Option"/>

                             <small t-if="message.is_author" class="o_mail_timestamp message-data-time" t-att-title="message.date.format(date_format)">
                                 <t t-esc="message.hour"/> - </small>

                            <strong t-if="!message.mailto and message.author_id[0]"
                                    data-oe-model="res.partner" t-att-data-oe-id="message.author_redirect ? message.author_id[0] : ''"
                                    t-attf-class="o_thread_author #{message.author_redirect ? 'o_mail_redirect' : ''}">
                                <i t-if="!message.is_author"  class="fa fa-circle online"></i>
                                 <t t-if="status" t-call="mail.chat.UserStatus"/>
                                <t t-esc="message.displayed_author"/>
                                 <t t-if="status" t-call="mail.chat.UserStatus"/>
                                <i t-if="message.is_author" class="fa fa-circle online me"></i>
                            </strong>
                            <strong t-if="!message.mailto and !message.author_id[0]" class="o_thread_author message-data-name">
                               <i t-if="!message.is_author" class="fa fa-circle online"></i>
                                 <t t-if="status" t-call="mail.chat.UserStatus"/>
                                <t t-esc="message.displayed_author"/>
                                <i t-if="message.is_author" class="fa fa-circle online me"></i>
                            </strong>

                           <small t-if="message.mailto|| !message.is_author" class="o_mail_timestamp message-data-time" t-att-title="message.date.format(date_format)"> - <t t-esc="message.hour"/></small>
                            <t t-if="message.model and (message.model != 'mail.channel') and options.display_document_link">
                                <a t-att-href="message.url" t-att-data-oe-model="message.model" t-att-data-oe-id="message.res_id" class="o_document_link">on <t t-esc="message.record_name"/></a>
                            </t>
                            <t t-if="message.origin_id and (message.origin_id !== options.channel_id)">
                                (from <a t-att-data-oe-id="message.origin_id" href="#">#<t t-esc="message.origin_name"/></a>)
                            </t>
                            <span t-if="options.display_email_icon and message.customer_email_data and message.customer_email_data.length" class="o_thread_tooltip_container">
                                <i t-att-class="'o_thread_tooltip o_thread_message_email o_thread_message_email_' + message.customer_email_status + ' fa fa-envelope-o'"/>
                                <span class="o_thread_tooltip_content">
                                    <t t-foreach="message.customer_email_data" t-as="customer">
                                        <span>
                                            <t t-if="customer[2] == 'sent'"><i class='fa fa-check'/></t>
                                            <t t-if="customer[2] == 'bounce'"><i class='fa fa-exclamation'/></t>
                                            <t t-if="customer[2] == 'exception'"><i class='fa fa-exclamation'/></t>
                                            <t t-if="customer[2] == 'ready'"><i class='fa fa-send-o'/></t>
                                            <t t-esc="customer[1]"/>
                                        </span>
                                        <br />
                                    </t>
                                </span>
                            </span>
                            <t t-if="message.mailto || !message.is_author" t-call="mail.chat.Option"/>
                        </p>

                        <div t-att-class="'o_thread_message_content'+(!message.display_author and !message.is_author?' marge':'') + (!message.mailto and message.is_author?' my-message pull-right':' other-message pull-left')">
                            <t t-if="message.tracking_value_ids and message.tracking_value_ids.length &gt; 0">
                                <t t-if="message.subtype_description">
                                    <p><t t-esc="message.subtype_description"/></p>
                                </t>
                                <t t-call="mail.ChatThread.MessageTracking"/>
                            </t>
                            <p t-if="options.display_subject and message.display_subject" class="o_mail_subject">Subject: <t t-esc="message.subject"/></p>
                            <t t-if="!(message.tracking_value_ids and message.tracking_value_ids.length &gt; 0)">
                                <t t-raw="message.body"/>
                            </t>
                             <t t-foreach="message.attachment_ids" t-as="attachment">
                                 <t t-call="mail.Attachment"/>
                             </t>
                        </div>
                    </div>
                </div>
             -->  </t>
       </t>
        <t t-name="mail.chat.Option">
                    <span t-attf-class="o_thread_icons">
                        <i t-if="options.displayStars and !message.isSystemNotification() and !message.needsModeration()"
                            t-att-class="'fa fa-lg o_thread_icon o_thread_message_star ' + (message.isStarred() ? 'fa-star' : 'fa-star-o')"
                            t-att-data-message-id="message.getID()" title="Mark as Todo" role="img" aria-label="Mark as Todo"/>
                       <i t-if="message.originatesFromChannel() and options.displayReplyIcons"
                           class="fa fa-reply o_thread_icon o_thread_message_reply"
                           t-att-data-message-id="message.getID()" title="Reply" role="img" aria-label="Reply"/>
                        <i t-if="message.isNeedaction() and options.displayMarkAsRead"
                           class="fa fa-check o_thread_icon o_thread_message_needaction"
                           t-att-data-message-id="message.getID()" title="Mark as Read" role="img" aria-label="Mark as Read"/>

                        <t t-if="message.needsModeration() and message.originatesFromChannel()">
                            <t t-if="message.needsModerationByUser()">
                                <t t-call="mail.MessageModerationDecision"/>
                            </t>
                            <t t-elif="message.isMyselfAuthor()">
                                <t t-call="mail.MessageModerationFeedback"/>
                            </t>
                        </t>
                    </span>
              </t>
</templates>